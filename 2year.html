<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Svt - CDP 2018</title>
    <script src="js/pixi.min.js"></script>
    <link rel="stylesheet" href="css/2year.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>
    <link href="http://www.dota2.com/public/css/blog/play.css?v=b4223247" rel="stylesheet" type="text/css">
    <script src="js/jquery.slides.min.js"></script>
    <script src="js/environmentSetup.js"></script>
    <script src="js/zones.js"></script>
    <script src="js/collision.js"></script>
    <script src="js/keyboard.js"></script>
</head>
<body>
<div id="canvas"></div>
<div id="memory">
    <img src="assets/png/photos/futbolmatch2.png">
</div>
<div class="containter">
<div class="step blue-gradient">
    <div class="info fromLeft grayFont">
        <h1>Teach Lead training</h1>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit.
            Phasellus tincidunt orci in eros congue molestie.
            Fusce et congue sapien. Cras vestibulum, diam sed dapibus dictum,
            nibh est euismod neque, non fermentum nibh metus sed odio.
            Mauris massa libero, tempor eget turpis vel, posuere scelerisque ipsum.
        </p>
    </div>
    <div class="picture ">

        <div class="skillCard" style="transform: rotate(-10deg);top:160px; left: 40px;">
            <div class="skillIcon">
                <img src="https://icon-icons.com/icons2/900/PNG/512/superhero_batman_hero_comic_icon-icons.com_69240.png">
            </div>
            <div class="skillName">Risk management</div>
        </div>
        <div class="skillCard" style="top:140px; left: 230px;">
            <div class="skillIcon">
                <img src="./assets/png/2year/building.png">
            </div>
            <div class="skillName">Architecture</div>
        </div>
        <div class="skillCard" style="transform: rotate(10deg);top:160px; left: 420px;">
            <div class="skillIcon">
                <img src="https://vignette.wikia.nocookie.net/leagueoflegends/images/b/b9/Mage_Large.png/revision/latest?cb=20140907112829">
            </div>
            <div class="skillName">Soft Skills</div>
        </div>
    </div>
</div>
<div class="step ">
    <div class="info fromLeft  ">
        <h1>Threat modeling</h1>
        <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit.
            Phasellus tincidunt orci in eros congue molestie.
            Fusce et congue sapien. Cras vestibulum, diam sed dapibus dictum,
            nibh est euismod neque, non fermentum nibh metus sed odio.
            Mauris massa libero, tempor eget turpis vel, posuere scelerisque ipsum.
        </p>
    </div>
    <div class="picture vine-gradient">
        <img src="https://mir-s3-cdn-cf.behance.net/project_modules/disp/cbb11c11608153.560fa6ea41721.png"
             height="400px" style="margin: 120px auto auto;">
    </div>
    </div>
<div class="step bg-latam" style="position: relative">
    <div class="portrait-container">
        <div class="portrait">
            <img src="assets/png/2year/equipo/Denisse1.png" width="100%" height="100%">
        </div>
        <div class="portrait">
            <img src="assets/png/2year/equipo/Daniela.jpg" width="100%" height="100%">
        </div>
        <div class="portrait">
            <img src="assets/png/2year/equipo/Jenny.jpg" width="100%" height="100%">
        </div>
        <div class="portrait">
            <img src="assets/png/2year/equipo/MAYRILIS_F.jpg" width="100%" height="100%">
        </div>
        <div class="portrait">
            <img src="assets/png/2year/equipo/foto_credencial.jpg" width="100%" height="100%">
        </div>
        <div class="portrait">
            <img src="assets/png/2year/equipo/Byron2.png" width="100%" height="100%">
        </div>
        <div class="portrait">
            <img src="assets/png/2year/equipo/freddy.png" width="100%" height="100%">
        </div>
        <div class="portrait">
            <img src="assets/png/2year/equipo/hector.png" width="100%" height="100%">
        </div>
        <div class="portrait">
            <img src="assets/png/2year/equipo/ManuelMedina.png" width="100%" height="100%">
        </div>
        <div class="portrait">
            <img src="assets/png/2year/equipo/sebas.png" width="100%" height="100%">
        </div>
    </div>
    <div class="arrow"></div>
</div>
<div class="step" style="position: relative">
    <div class="arrow"></div>
</div>
<div class="step" style="position: relative">
</div>
</div>
<script type="text/javascript">
    var Container = PIXI.Container,
        autoDetectRenderer = PIXI.autoDetectRenderer,
        loader = PIXI.loader,
        resources = PIXI.loader.resources,
        Sprite = PIXI.Sprite;
    var stage = new Container();
    var state;
    var contentDiv = $("#canvas");
    var screenWidth = contentDiv.width();
    var screenHeight = contentDiv.height() - 4;
    var renderer = autoDetectRenderer(screenWidth, screenHeight, {transparent: true});
    var player;
    var idleFrames = [];
    var walkingFrames = [];
    var attackingFrames = [];
    var bullets = [];
    var jumpFrames = [];
    var gunAttackingFrames = [];
    var whiteTeleportFrames = [];
    var smokeFrames = [];
    var swordAttackingFrames = [];
    var scrollCount = 1;

    /*Team*/
    var teamFrames = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []];
    var teamPositions = [[180, 100],[450, 100],[720, 100],[990,100],[1260,100],[180,300],[450,300],[720,300],[990,300], [1260,300]];
    var team = [];

    var teleportFrameCount = 0;
    var teleport;
    var smoke;
    var plane;
    var xScale = 0.30;
    var left = keyboard(37),
        right = keyboard(39),
        space = keyboard(32),
        esc = keyboard(27),
        ctrl = keyboard(17),
        xkey = keyboard(88),
        vkey = keyboard(86),
        qkey = keyboard(81),
        akey = keyboard(65),
        ckey = keyboard(67);
    contentDiv.append(renderer.view);
    loadPlayerAssets();
    loadTeleportAssets();
    loadSmokeAssets();
    loadTeamAssets();
    loader.add("./assets/png/Object/sword.png")
        .add("./assets/png/Object/gun.png")
        .add("./assets/png/2year/equipo/plane.png")
        .load(setup);
    let fourText = new PIXI.Text('4',{fontFamily : 'Arial', fontSize: 600, fill : 0x212C7E, align : 'center'});
    fourText.x = screenWidth / 2 - 150;
    fourText.y = screenHeight - 800;

    var buildAnimation = {
        target: {x: screenWidth / 2, y: screenHeight - 200},
        done: false,
        completed: [],
        result: fourText,
        postAnimation: () => {
            setTimeout(() => {
                team.map((member) => {
                    member.x = member.standByPosition.x
                });
            },2000);
        },
        preAnimation: () => {

        }
    };

    var planeAnimation = {
        target: {x: screenWidth / 2, y: screenHeight - 200},
        done: false,
        completed: [],
        result: plane,
        postAnimation: () => {
            setTimeout(() => {
                team.map((member) => {
                    member.x = member.standByPosition.x
                });
            },2000);
        },
        preAnimation: () => {
            stage.removeChild(fourText);
        }
    };

    var animations = [buildAnimation, planeAnimation];
    var animation = null;


    function setup() {

        setKeyboardFunctions();

        setEnvironment();

        renderer.render(stage);

        state = play;

    }

    function gameLoop() {
        requestAnimationFrame(gameLoop);
        state();
        renderer.render(stage);
    }

    function play() {
        processCharacterMovement();
    }

    function processCharacterMovement() {

        team.map((member, index) => {
            try{
                if(member.vy !== 0){
                    stage.getChildIndex(member);
                    if(member.y < calculateFloorYPosition(member) - member.height){
                        member.y += member.vy;
                        if(index < 5){
                            member.x+=1.8;
                        }
                    }else{
                        member.y = calculateFloorYPosition(member)  - member.height;
                        member.vy = 0;
                        member.standByPosition = { x: member.x, y: member.y };
                    }
                }
            }catch (error){}

        });
        if( animation !== null){
            animation.preAnimation();
            team.map((member) => {
                if(animation.completed.indexOf(member) === -1) {
                    if (member.x > animation.target.x) {
                        member.x -= 5;
                        if (member.x < animation.target.x) {
                            member.x = animation.target.x;
                        }
                        member.scale.x = xScale * -1;
                    }
                    if (member.x < animation.target.x) {
                        member.x += 5;
                        if (member.x > animation.target.x) {
                            member.x = animation.target.x;
                        }
                        member.scale.x = xScale;
                    }
                    if (member.x === animation.target.x) {
                        animation.completed.push(member);
                    }
                }
            });
            if(animation.completed.length === 10){
                animation.done = true;
                stage.addChild(smoke);
                smoke.gotoAndPlay(0);
                smoke.x=animation.target.x;
                smoke.y=animation.target.y - smoke.height / 3;
                smoke.scale.set(3);
                smoke.onComplete = () => {
                    stage.removeChild(smoke);
                };
                stage.addChild(animation.result);

            }
            if(animation.done){
                animation.postAnimation();
                animation = null;
            }
        }

        let hitsLimits = contain(player, {
            x: screenWidth * 0.02,
            y: 10,
            width: screenWidth + player.width / 2,
            height: calculateFloorYPosition(player)
        });
        if (hitsLimits === "right") {
            player.vx = 0;
            world.vx = -5;
        }

        if (hitsLimits === "left") {
            player.vx = 0;
            world.vx = 5;
        }

        if (hitsLimits === "bottom" && player.state !== "jumping") {
            player.vy = 0;
        }

        if (world.vx < 1 && world.x * -1 + screenWidth > 10)
            world.vx = 0;
        if (world.vx > 1 && world.x > -10)
            world.vx = 0;
        if (player.vy !== 0)
            player.vy += 0.4;

        player.x += player.vx;
        player.y += player.vy;
        world.x += world.vx;
        if (!player.playing && player.vy > 0) {
            if (!right.isDown && !left.isDown) {
                idleAnimation();
            } else {
                setWalkingAnimation();
            }
            player.loop = true;
            player.play();
        }
    }

    function setEnvironment() {
        world = new Container();
        world.vx = 0;
        loadAnimationFrames();
        loadTeleportFrames();
        loadSmokeFrames();
        loadTeamFrames();
        stage.addChild(world);

        teleport = new PIXI.extras.AnimatedSprite(whiteTeleportFrames);

        teleport.animationSpeed = 0.15;
        teleport.play();
        teleport.anchor.set(0.5);
        teleport.scale.set(1);
        teleport.loop = false;

        smoke = new PIXI.extras.AnimatedSprite(smokeFrames);
        smoke.animationSpeed = 0.1;
        smoke.anchor.set(0.5);
        smoke.scale.set(1);
        smoke.loop = false;

        plane = new PIXI.extras.AnimatedSprite([PIXI.Texture.fromFrame("./assets/png/2year/equipo/plane.png")]);
        plane.anchor.set(0.5);
        plane.scale.set(0.3);
        plane.loop = false;
        plane.position.set(screenWidth /2, 350);
        planeAnimation.result = plane;


        player = new PIXI.extras.AnimatedSprite(idleFrames);
        player.animationSpeed = 0.3;
        player.play();
        player.anchor.set(0.5);
        player.scale.set(xScale);
        player.vx = 0;
        player.vy = 0;
        player.attack = 0;
        player.inventory = [];
        player.attackingFrames = attackingFrames;
        player.position.set(300, 350);
        for(i=0; i< 10; i++){
            let teamMember = new PIXI.extras.AnimatedSprite(teamFrames[i*2]);
            teamMember.animationSpeed = 0.12;
            teamMember.play();
            teamMember.anchor.set(0.5);
            teamMember.scale.set(xScale);
            teamMember.position.set(teamPositions[i][0],teamPositions[i][1]);
            teamMember.runFrames = teamFrames[i + i*2 + 1];
            teamMember.vy = 10;
            team.push(teamMember);
        }
    }

    function spawnCharacter() {
        try {
            stage.getChildIndex(player);
            stage.addChild(teleport);
            teleport.position.set(player.position.x, player.position.y);
            teleport.onComplete = () => {
                stage.removeChild(teleport);
                stage.removeChild(player);
            };
            teleport.onFrameChange = null;
            teleport.gotoAndPlay(0);

        } catch (error) {
            teleportFrameCount = 0;
            teleport.position.set(300, screenHeight - 100);
            stage.addChild(teleport);
            teleport.onFrameChange = function () {
                teleportFrameCount++;
                if (teleportFrameCount > teleport.totalFrames - 5) {
                    player.position.set(300, screenHeight);
                    player.scale.set(xScale - 0.05 * (teleport.totalFrames - teleportFrameCount));
                    stage.addChild(player);
                }
            };
            teleport.onComplete = () => {
                stage.removeChild(teleport);
            };
            teleport.gotoAndPlay(0);
        }
    }

    function walkAnimation(direction) {
        if (player.state !== "walking") {
            player.textures = walkingFrames;
            player.scale.x = xScale * direction;
            player.state = "walking";
        }
    }

    function idleAnimation() {
        if (player.state !== "idle") {
            player.textures = idleFrames;
            player.state = "idle";
        }
    }

    function attackAnimation() {
        if (player.state !== "attacking") {
            player.textures = player.attackingFrames;
            player.state = "attacking";
            if (player.textures === gunAttackingFrames) {
                var bullet = new Sprite(resources["./assets/png/Object/bullet-2.png"].texture);
                bullet.anchor.set(0.5);
                bullet.scale.set(0.08);
                bullet.y = player.y + player.height / 5;
                bullets.push(bullet);
                if (player.facing === "right") {
                    bullet.vx = 10;
                    bullet.x = player.x + player.width / 2;
                } else {
                    bullet.scale.x = -0.08;
                    bullet.vx = -10;
                    bullet.x = player.x - player.width / 2;
                }
                stage.addChild(bullet);
            }
        }
    }

    function jumpAnimation() {
        if (player.state !== "jumping") {
            player.textures = jumpFrames;
            player.state = "jumping";
            player.loop = false;
        }
    }

    function setWalkingAnimation() {
        if (player.vx > 0 || world.vx < 0) {
            walkAnimation(1);
        } else {
            walkAnimation(-1);
        }
    }

    function calculateFloorYPosition(sprite) {
        return screenHeight + sprite.height / 2 ;
    }

    function setKeyboardFunctions() {
        left.press = function () {
            if (!right.isDown) {
                walkAnimation(-1);
                player.vx = -5;
                player.facing = "left";
            }
        };

        left.release = function () {
            player.vx = 0;
            world.vx = 0;
            idleAnimation();
        };

        right.press = function () {
            if (!left.isDown) {
                walkAnimation(1);
                player.vx = 5;
                player.facing = "right";
            }
        };
        right.release = function () {
            player.vx = 0;
            world.vx = 0;
            idleAnimation();
        };

        space.press = function () {
            if (player.vy === 0) {
                player.vy = -12;
                jumpAnimation();
            }
        };

        ctrl.press = function () {
            attackAnimation();
        };

        ctrl.release = function () {
            if (player.vx === 0 && world.vx === 0) {
                idleAnimation();
            } else {
                setWalkingAnimation();
            }
        };

        esc.release = function () {
            $(".photoContainer").hide();
            $(".slider").hide();
        };

        xkey.release = function () {
            spawnCharacter();
        };

        vkey.release = function () {
            for(i=0; i< 10; i++){
                stage.addChild(team[i]);
                team[i].vy = 10;
            }
        };

        ckey.release = function () {
            $("#memory").toggle();
            $("#memory").css({
                bottom: screenHeight - player.position.y + player.height / 2 + 30,
                left: player.position.x - $("#memory").children()[0].width / 2
            });
        };
        qkey.release = function () {
            window.scrollTo(0,(screenHeight + 5) * scrollCount);
            scrollCount ++ ;
        };
        akey.release = () => {
            if(animations.length > 0){
                animation = animations.splice(0,1)[0];
            }
        }
    }

    gameLoop();

</script>
</body>
</html>